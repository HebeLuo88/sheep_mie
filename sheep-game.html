<!DOCTYPE html>
<html>
<head>
    <title>ç¾Šäº†ä¸ªç¾Š</title>
    <style>
        #game-board {
            width: 400px;
            height: 600px;
            margin: 20px auto;
            position: relative;
        }

        .tile {
            width: 80px;
            height: 80px;
            position: absolute;
            border: 2px solid #fff;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .tile:hover {
            transform: scale(1.1);
            z-index: 100;
        }

        #status {
            text-align: center;
            font-size: 24px;
            margin: 20px;
        }

        .slot {
            background: #666;
        }

        #slot-container {
            width: 400px;
            height: 100px;
            margin: 20px auto;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border: 2px solid #ccc;
            border-radius: 10px;
        }

        .slot {
            width: 80px;
            height: 80px;
            border: 2px dashed #aaa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        /* æ·»åŠ å¡æ§½åŠ¨ç”» */
        @keyframes slot-bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* æ·»åŠ æ–¹å—ç‚¹å‡»åé¦ˆ */
        .tile:active {
            transform: scale(0.9) !important;
        }

        @keyframes slot-disappear {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(0.5); }
        }
    </style>
</head>
<body>
    <div id="status">å‰©ä½™æ–¹å—ï¼š<span id="count">0</span></div>
    <div id="game-board"></div>
    <div id="slot-container">
        <div class="slot" id="slot-0"></div>
        <div class="slot" id="slot-1"></div>
        <div class="slot" id="slot-2"></div>
        <div class="slot" id="slot-3"></div>
        <div class="slot" id="slot-4"></div>
        <div class="slot" id="slot-5"></div>
        <div class="slot" id="slot-6"></div>
        <div class="slot" id="slot-7"></div>
        <div class="slot" id="slot-8"></div>
        <div class="slot" id="slot-9"></div>
    </div>

    <script>
        const TYPES = ['ğŸ‘', 'ğŸŒ¿', 'ğŸ¥•', 'ğŸƒ', 'ğŸ', 'ğŸŒ½'];
        const LAYERS = 3;
        const GRID_SIZE = 4;
        let selectedTiles = [];
        let slots = Array(10).fill(null);

        function createGame() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            
            // åˆ›å»ºä¸‰å±‚å †å çš„æ–¹å—
            for(let layer = 0; layer < LAYERS; layer++) {
                for(let i = 0; i < GRID_SIZE; i++) {
                    for(let j = 0; j < GRID_SIZE; j++) {
                        const tile = document.createElement('div');
                        tile.className = 'tile';
                        tile.style.left = `${j * 90 + layer * 5}px`;
                        tile.style.top = `${i * 90 + layer * 5}px`;
                        tile.style.backgroundColor = `hsl(${Math.random()*360}, 70%, 70%)`;
                        tile.dataset.type = TYPES[Math.floor(Math.random()*TYPES.length)];
                        tile.dataset.layer = layer;
                        tile.textContent = tile.dataset.type;
                        
                        tile.onclick = () => handleClick(tile);
                        board.appendChild(tile);
                    }
                }
            }
            updateCount();
        }

        function handleClick(tile) {
            // æ›´ç²¾ç¡®çš„ç‚¹å‡»ä½ç½®æ£€æµ‹
            const rect = tile.getBoundingClientRect();
            const centerX = rect.left + rect.width/2;
            const centerY = rect.top + rect.height/2;
            
            // æ£€æµ‹å½“å‰ç‚¹å‡»çš„æ–¹å—æ˜¯å¦æ˜¯æœ€é¡¶å±‚å¯è§çš„
            const topElement = document.elementFromPoint(centerX, centerY);
            if (!tile.contains(topElement)) {
                return; // ä¸æ˜¾ç¤ºalerté¿å…å¹²æ‰°
            }

            // å¯»æ‰¾ç¬¬ä¸€ä¸ªç©ºå¡æ§½
            const emptySlotIndex = slots.indexOf(null);
            if (emptySlotIndex === -1) {
                alert('å¡æ§½å·²æ»¡ï¼');
                return;
            }

            // æ›´æ–°å¡æ§½çŠ¶æ€å’Œæ˜¾ç¤ºï¼ˆæ·»åŠ åŠ¨ç”»æ•ˆæœï¼‰
            slots[emptySlotIndex] = tile.dataset.type;
            const slotElement = document.getElementById(`slot-${emptySlotIndex}`);
            slotElement.textContent = tile.dataset.type;
            slotElement.style.animation = 'slot-bounce 0.5s';
            
            // ç§»é™¤åŠ¨ç”»ç»“æŸåæ¸…é™¤æ ·å¼
            slotElement.addEventListener('animationend', () => {
                slotElement.style.animation = '';
            });

            // ç§»é™¤æ–¹å—å¹¶æ›´æ–°æ¸¸æˆçŠ¶æ€
            tile.style.opacity = '0'; // æ¸éšæ•ˆæœ
            setTimeout(() => tile.remove(), 300);
            updateLayers();
            updateCount();
            
            // ç«‹å³æ£€æŸ¥æ¶ˆé™¤ï¼ˆä¿®å¤å»¶è¿Ÿé—®é¢˜ï¼‰
            checkSlotMatches();
            checkWin();
        }

        function updateLayers() {
            document.querySelectorAll('.tile').forEach(tile => {
                const below = document.elementFromPoint(
                    parseFloat(tile.style.left) + 40,
                    parseFloat(tile.style.top) + 40
                );
                tile.dataset.layer = below === tile ? 0 : 1;
            });
        }

        function updateCount() {
            document.getElementById('count').textContent = 
                document.querySelectorAll('.tile').length;
        }

        function checkWin() {
            if (document.querySelectorAll('.tile').length === 0) {
                setTimeout(() => alert('èƒœåˆ©ï¼ğŸ‰'), 100);
            }
        }

        function checkSlotMatches() {
            let hasMatches = false;
            
            // åˆ›å»ºç±»å‹åˆ°ä½ç½®çš„æ˜ å°„
            const typeMap = new Map();
            slots.forEach((type, index) => {
                if (type) {
                    if (!typeMap.has(type)) typeMap.set(type, []);
                    typeMap.get(type).push(index);
                }
            });

            // æ£€æŸ¥æ‰€æœ‰ç±»å‹çš„å‡ºç°æ¬¡æ•°
            typeMap.forEach((positions, type) => {
                while (positions.length >= 3) {
                    hasMatches = true;
                    // å–å‡ºå‰ä¸‰ä¸ªä½ç½®è¿›è¡Œæ¶ˆé™¤
                    const [a, b, c] = positions.splice(0, 3);
                    
                    // æ¸…ç©ºå¡æ§½
                    slots[a] = null;
                    slots[b] = null;
                    slots[c] = null;
                    
                    // æ›´æ–°æ˜¾ç¤ºï¼ˆæ·»åŠ æ¶ˆé™¤åŠ¨ç”»ï¼‰
                    [a, b, c].forEach(index => {
                        const slot = document.getElementById(`slot-${index}`);
                        slot.style.animation = 'slot-disappear 0.5s';
                        slot.addEventListener('animationend', () => {
                            slot.textContent = '';
                            slot.style.animation = '';
                        }, {once: true});
                    });
                }
            });

            // å¦‚æœæœ‰æ¶ˆé™¤éœ€è¦é‡æ–°æ£€æŸ¥ï¼ˆå¤„ç†å¤šä¸ªä¸‰è¿æƒ…å†µï¼‰
            if (hasMatches) {
                setTimeout(checkSlotMatches, 500); // ç­‰å¾…åŠ¨ç”»å®Œæˆ
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        createGame();
    </script>
</body>
</html> 